<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–¢–µ–∫—Å—Ç–æ–≤–∞—è RPG ‚Äî –î–æ—Ä–æ–≥–∞</title>
  <style>
    @font-face {
      font-family: 'Perfect DOS VGA 437';
      src: url('https://unpkg.com/dos-font@1.0.0/web/PerfectDOSVGA437.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }
    
    @font-face {
      font-family: 'Windows XP';
      src: local('Tahoma'), local('Verdana'), local('Arial');
    }
    
    :root{
      --xp-blue: #0080ff;
      --xp-light-blue: #9fc7e4;
      --xp-dark-blue: #004080;
      --xp-gray: #c0c0c0;
      --xp-light-gray: #e0e0e0;
      --xp-dark-gray: #808080;
      --xp-white: #ffffff;
      --xp-black: #000000;
      --xp-green: #008000;
      --xp-red: #ff0000;
      --xp-yellow: #ffff00;
    }
    
    *{box-sizing:border-box; margin:0; padding:0}
    
    body{
      margin:0; 
      background: linear-gradient(135deg, var(--xp-blue) 0%, var(--xp-dark-blue) 100%);
      color:var(--xp-black); 
      font-family: 'Windows XP', Tahoma, Verdana, Arial, sans-serif;
      font-size: 12px;
      line-height: 1.4;
    }
    
    .container{
      max-width:800px; 
      margin:20px auto; 
      padding:15px;
      background: var(--xp-light-gray);
      border: 2px solid var(--xp-dark-gray);
      border-radius: 0;
      box-shadow: 4px 4px 0px var(--xp-dark-gray);
    }
    
    .stats{
      display:grid; 
      grid-template-columns:repeat(5,1fr); 
      gap:6px; 
      position:sticky; 
      top:0; 
      padding:8px;
      background: var(--xp-gray);
      border: 2px solid var(--xp-dark-gray);
      z-index:5;
      margin-bottom: 15px;
    }
    
    .stat{
      background: var(--xp-white);
      border: 2px solid var(--xp-dark-gray);
      border-radius: 0;
      padding:8px;
      text-align:center;
      font-family: 'Perfect DOS VGA 437', 'Courier New', monospace;
      font-size: 11px;
      box-shadow: inset 1px 1px 0px var(--xp-light-gray), inset -1px -1px 0px var(--xp-dark-gray);
    }
    
    #scene{
      background: var(--xp-white);
      border: 2px solid var(--xp-dark-gray);
      border-radius: 0;
      padding:15px;
      margin-bottom: 15px;
      box-shadow: inset 1px 1px 0px var(--xp-light-gray), inset -1px -1px 0px var(--xp-dark-gray);
    }
    
    #text{
      line-height:1.5;
      font-family: 'Windows XP', Tahoma, Verdana, Arial, sans-serif;
      font-size: 13px;
      margin-bottom: 15px;
      color: var(--xp-black);
    }
    
    #actions{
      display:flex; 
      flex-wrap:wrap; 
      gap:6px; 
      margin-top:12px;
    }
    
    button{
      background: linear-gradient(to bottom, var(--xp-light-blue) 0%, var(--xp-blue) 100%);
      border: 2px solid;
      border-top-color: var(--xp-white);
      border-left-color: var(--xp-white);
      border-right-color: var(--xp-dark-blue);
      border-bottom-color: var(--xp-dark-blue);
      border-radius: 0;
      padding:6px 12px;
      color: var(--xp-black);
      cursor:pointer;
      font-family: 'Perfect DOS VGA 437', 'Courier New', monospace;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-width: 120px;
      height: 32px;
      box-shadow: 2px 2px 0px var(--xp-dark-gray);
      transition: all 0.1s ease;
    }
    
    button:hover{
      background: linear-gradient(to bottom, var(--xp-blue) 0%, var(--xp-dark-blue) 100%);
      color: var(--xp-white);
      transform: translate(1px, 1px);
      box-shadow: 1px 1px 0px var(--xp-dark-gray);
    }
    
    button:active{
      transform: translate(2px, 2px);
      box-shadow: 0px 0px 0px var(--xp-dark-gray);
      border-top-color: var(--xp-dark-blue);
      border-left-color: var(--xp-dark-blue);
      border-right-color: var(--xp-white);
      border-bottom-color: var(--xp-white);
    }
    
    button:disabled{
      background: var(--xp-gray);
      color: var(--xp-dark-gray);
      border: 2px solid var(--xp-dark-gray);
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    
    button.accent{
      background: linear-gradient(to bottom, #90ee90 0%, var(--xp-green) 100%);
      border-right-color: #006400;
      border-bottom-color: #006400;
    }
    
    button.danger{
      background: linear-gradient(to bottom, #ffb6c1 0%, var(--xp-red) 100%);
      border-right-color: #8b0000;
      border-bottom-color: #8b0000;
    }
    
    #history{
      background: var(--xp-black);
      border: 2px solid var(--xp-dark-gray);
      border-radius: 0;
      padding:12px;
      height:200px;
      overflow-y:auto;
      font-family: 'Perfect DOS VGA 437', 'Courier New', monospace;
      font-size: 12px;
      color: #00ff00;
      line-height: 1.3;
      white-space:pre-wrap;
      box-shadow: inset 1px 1px 0px #333, inset -1px -1px 0px #333;
    }
    
    small.muted{
      color: var(--xp-dark-gray);
      font-style: italic;
    }
    
    .toolbar{
      display:flex; 
      gap:8px; 
      margin-top:15px;
    }
    
    .window-title{
      background: linear-gradient(90deg, var(--xp-dark-blue) 0%, var(--xp-blue) 100%);
      color: var(--xp-white);
      padding: 8px 15px;
      margin: -15px -15px 15px -15px;
      border-bottom: 2px solid var(--xp-dark-gray);
      font-family: 'Perfect DOS VGA 437', 'Courier New', monospace;
      font-weight: bold;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –≤ —Å—Ç–∏–ª–µ XP */
    #history::-webkit-scrollbar {
      width: 16px;
    }
    
    #history::-webkit-scrollbar-track {
      background: var(--xp-gray);
      border: 2px solid var(--xp-dark-gray);
      box-shadow: inset 1px 1px 0px var(--xp-light-gray);
    }
    
    #history::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, var(--xp-light-blue) 0%, var(--xp-blue) 100%);
      border: 2px solid;
      border-top-color: var(--xp-white);
      border-left-color: var(--xp-white);
      border-right-color: var(--xp-dark-blue);
      border-bottom-color: var(--xp-dark-blue);
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –º–∏–≥–∞—é—â–µ–≥–æ –∫—É—Ä—Å–æ—Ä–∞ –¥–ª—è –ª–æ–≥–∞ */
    #history::after {
      content: '_';
      animation: blink 1s infinite;
      color: #00ff00;
    }
    
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="window-title">üöÄ RPG ADVENTURE - WINDOWS XP EDITION</div>
    
    <div class="stats">
      <div class="stat">‚ù§Ô∏è HP: <span id="hp"></span>/<span id="hpMax"></span></div>
      <div class="stat">üí∞ –ó–û–õ–û–¢–û: <span id="gold"></span></div>
      <div class="stat">üì¶ –†–ï–°–£–†–°–´: <span id="res"></span></div>
      <div class="stat">üí• ATK–ê–ö–ê: <span id="atk"></span></div>
      <div class="stat">‚ö° –°–ò–õ–ê: <span id="pow"></span>/<span id="powMax"></span></div>
    </div>

    <div id="scene">
      <div id="text"></div>
      <div id="actions"></div>
    </div>

    <div id="history" aria-label="SYSTEM LOG"></div>
    <div class="toolbar">
      <button id="clearLog">CLEAR LOG</button>
      <button id="restart">NEW GAME</button>
    </div>
  </div>

  <script>
    // === –°–û–°–¢–û–Ø–ù–ò–ï ===
    const state = {
      hp: 100, hpMax: 100,
      gold: 10,
      res: 0,
      atk: 1, // –≤–ª–∏—è–µ—Ç –Ω–∞ —É—Ä–æ–Ω –ø–æ –≤—Ä–∞–≥—É (–∫—É–∑–Ω–µ—Ü –ø–æ–≤—ã—à–∞–µ—Ç)
      pow: 50, powMax: 50, // –Ω–æ–≤–∞—è ¬´—Å–∏–ª–∞¬ª ‚Äî —Ç—Ä–∞—Ç–∏—Ç—Å—è –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
      scene: 'road',
      enemy: null,
      village: { rate: null, restPrice: null, forgePrice: null, tavernPrice: null },
      forestCost: null, // —Ç–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–∏–ª—ã –¥–ª—è –æ—Ö–æ—Ç—ã (–∑–∞ –≤—Ö–æ–¥ –≤ –ª–µ—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ)
      lakeCost: null,   // —Ç–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–∏–ª—ã –¥–ª—è —Ä—ã–±–∞–ª–∫–∏ (–∑–∞ –≤—Ö–æ–¥ –∫ –æ–∑–µ—Ä—É –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ)
      log: []
    };

    // === –ë–ê–õ–ê–ù–° ===
    const BALANCE = {
      roadWeights: { enemy: 0.4, village: 0.25, forest: 0.2, lake: 0.15 },
      fleeGoldMin: 2, fleeGoldMax: 10,
      enemy: { hpMin: 15, hpMax: 35, dmgMin: 3, dmgMax: 8, playerBaseDmgMin: 3, playerBaseDmgMax: 7, rewardResMin: 1, rewardResMax: 5 },
      rest: { healMin: 15, healMax: 30, robChance: 0.12, robMin: 1, robMax: 15 },
      village: { rateMin: 3, rateMax: 7, restPriceMin: 8, restPriceMax: 14, forgeBasePrice: 12, forgePriceStep: 6, tavernBasePrice: 15, tavernPriceMultiplier: 1.5 },
      forest: { resMin: 1, resMax: 3, hurtChance: 0.35, hurtMin: 1, hurtMax: 4, powCostMin: 5, powCostMax: 15 },
      lake: { baitCost: 1, successChance: 0.65, resGainMin: 3, resGainMax: 5, powCostMin: 5, powCostMax: 15 }
    };

    const ENEMY_NAMES = ["–í–æ–ª–∫", "–†–∞–∑–±–æ–π–Ω–∏–∫", "–ü–æ–∫–æ–π–Ω–∏–∫", "–ú–µ–¥–≤–µ–¥—å", "–ì–æ–±–ª–∏–Ω", "–û—Ä–∫", "–ë–∞–Ω–¥–∏—Ç", "–í–µ–ø—Ä—å"];

    // === –£–¢–ò–õ–ò–¢–´ ===
    const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const chance = (p) => Math.random() < p;
    function log(msg){
      const timestamp = new Date().toLocaleTimeString();
      state.log.push(`[${timestamp}] ${msg}`);
      const h = document.getElementById('history');
      const el = document.createElement('div');
      el.textContent = `> ${msg}`;
      el.style.fontFamily = "'Perfect DOS VGA 437', 'Courier New', monospace";
      el.style.fontSize = "11px";
      h.appendChild(el);
      h.scrollTop = h.scrollHeight;
    }

    // === –†–ï–ù–î–ï–† ===
    function renderStats(){
      document.getElementById('hp').textContent = state.hp;
      document.getElementById('hpMax').textContent = state.hpMax;
      document.getElementById('gold').textContent = state.gold;
      document.getElementById('res').textContent = state.res;
      document.getElementById('atk').textContent = state.atk;
      document.getElementById('pow').textContent = state.pow;
      document.getElementById('powMax').textContent = state.powMax;
    }
    function setText(html){ document.getElementById('text').innerHTML = html; }
    function setActions(buttons){
      const c = document.getElementById('actions');
      c.innerHTML = '';
      buttons.forEach(b=>{
        const btn = document.createElement('button');
        btn.textContent = b.label;
        if(b.className) btn.className = b.className;
        btn.onclick = b.onClick;
        if (b.disabled) btn.disabled = true;
        c.appendChild(btn);
      });
    }

    // === –î–û–†–û–ì–ê ===
    function goToRoad(initial=false){
      state.scene = 'road';
      setText(initial
        ? '<b>–í–´ –ù–ê –î–û–†–û–ì–ï.</b> –ù–ê–ñ–ú–ò–¢–ï ¬´–í–ü–ï–†–Å–î¬ª, –ß–¢–û–ë–´ –ù–ê–ß–ê–¢–¨ –ü–£–¢–ï–®–ï–°–¢–í–ò–ï.'
        : '<b>–í–´ –°–ù–û–í–ê –ù–ê –î–û–†–û–ì–ï.</b> –ß–¢–û –ñ–î–Å–¢ –í–ê–° –í–ü–ï–†–ï–î–ò?');
      setActions([{ label: '–í–ü–ï–†–Å–î', className: 'accent', onClick: ()=>{ log('–í–´ –î–í–ò–ì–ê–ï–¢–ï–°–¨ –ü–û –î–û–†–û–ì–ï...'); rollEvent(); } }]);
      if (initial) log('–°–ò–°–¢–ï–ú–ê –ó–ê–ü–£–©–ï–ù–ê. –î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨ –í –ü–†–ò–ö–õ–Æ–ß–ï–ù–ò–ï!');
    }

    function rollEvent(){
      const r = Math.random();
      const w = BALANCE.roadWeights; let acc = 0;
      if (r < (acc += w.enemy)) return enterEnemy();
      if (r < (acc += w.village)) return enterVillage();
      if (r < (acc += w.forest)) return enterForest();
      return enterLake();
    }

    // === –í–†–ê–ì ===
    function enterEnemy(){
      const eHP = rnd(BALANCE.enemy.hpMin, BALANCE.enemy.hpMax);
      const eDmg = rnd(BALANCE.enemy.dmgMin, BALANCE.enemy.dmgMax);
      const name = ENEMY_NAMES[rnd(0, ENEMY_NAMES.length-1)];
      state.enemy = { hp: eHP, dmg: eDmg, name };
      state.scene = 'enemy';
      setText(`<b>${name}!</b> –ó–î–û–†–û–í–¨–ï –í–†–ê–ì–ê: ${eHP}. –£–†–û–ù –í–†–ê–ì–ê: ${eDmg}.`);
      setActions([
        { label: '–ê–¢–ê–ö–ê (-1 –°–ò–õ–ê)', className: 'danger', onClick: attackEnemy, disabled: state.pow <= 0 },
        { label: '–ü–û–ë–ï–ì', onClick: fleeEnemy }
      ]);
      log(`–û–ë–ù–ê–†–£–ñ–ï–ù ${name} (HP ${eHP}, DMG ${eDmg})`);
    }

    function attackEnemy(){
      if (state.scene !== 'enemy' || !state.enemy) return;
      if (state.pow <= 0){ log('–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–ò–õ–´ –î–õ–Ø –ê–¢–ê–ö–ò'); return; }
      state.pow -= 1;
      const dmg = rnd(BALANCE.enemy.playerBaseDmgMin, BALANCE.enemy.playerBaseDmgMax) + state.atk;
      state.enemy.hp -= dmg;
      log(`–ê–¢–ê–ö–ê –ü–û ${state.enemy.name}: ${dmg} –£–†–û–ù–ê. (HP –í–†–ê–ì–ê: ${Math.max(0, state.enemy.hp)})`);

      if (state.enemy.hp <= 0){
        const gain = rnd(BALANCE.enemy.rewardResMin, BALANCE.enemy.rewardResMax);
        state.res += gain;
        log(`${state.enemy.name} –£–ù–ò–ß–¢–û–ñ–ï–ù! +${gain} –†–ï–°–£–†–°–û–í.`);
        state.enemy = null;
        state.scene = 'postBattle';
        setText(`<b>–ü–û–ë–ï–î–ê!</b> –í–´–ë–ï–†–ò–¢–ï –î–ê–õ–¨–ù–ï–ô–®–ï–ï –î–ï–ô–°–¢–í–ò–ï`);
        setActions([
          { label: '–í–ü–ï–†–Å–î', className: 'accent', onClick: ()=>{ log('–ü–†–û–î–û–õ–ñ–ï–ù–ò–ï –ü–£–¢–ò...'); goToRoad(false); } },
          { label: '–û–¢–î–û–•–ù–£–¢–¨', onClick: restOutside }
        ]);
        renderStats();
        return;
      }

      // –û—Ç–≤–µ—Ç–Ω—ã–π —É–¥–∞—Ä –≤—Ä–∞–≥–∞
      const eHit = rnd(state.enemy.dmg, state.enemy.dmg + 2);
      state.hp -= eHit;
      log(`${state.enemy.name} –ê–¢–ê–ö–£–ï–¢: ${eHit} –£–†–û–ù–ê. (–í–ê–®–ï HP: ${Math.max(0, state.hp)})`);
      if (state.hp <= 0) return gameOver(`${state.enemy.name} –û–ö–ê–ó–ê–õ–°–Ø –°–ò–õ–¨–ù–ï–ï. –í–´ –ü–û–ì–ò–ë–õ–ò –í –ë–û–Æ.`);

      setText(`<b>–ë–û–ô!</b> ${state.enemy.name} –ï–©–Å –°–†–ê–ñ–ê–ï–¢–°–Ø.`);
      setActions([
        { label: '–ê–¢–ê–ö–ê (-1 –°–ò–õ–ê)', className: 'danger', onClick: attackEnemy, disabled: state.pow <= 0 },
        { label: '–ü–û–ë–ï–ì', onClick: fleeEnemy }
      ]);
      renderStats();
    }

    function fleeEnemy(){
      const lose = Math.min(state.gold, rnd(BALANCE.fleeGoldMin, BALANCE.fleeGoldMax));
      state.gold -= lose;
      log(`–ü–û–ë–ï–ì –£–°–ü–ï–®–ï–ù. –ü–û–¢–ï–†–Ø–ù–û –ó–û–õ–û–¢–ê: ${lose}`);
      renderStats();
      goToRoad(false);
    }

    // === –û–¢–î–´–• –í–ù–ï –î–ï–†–ï–í–ù–ò ===
    function restOutside(){
      const robbed = chance(BALANCE.rest.robChance);
      if (robbed && state.res > 0){
        const loss = Math.min(state.res, rnd(BALANCE.rest.robMin, BALANCE.rest.robMax));
        state.res -= loss;
        log(`–í–´ –ë–´–õ–ò –û–ì–†–ê–ë–õ–ï–ù–´ –í–û –í–†–ï–ú–Ø –û–¢–î–´–•–ê. –ü–û–¢–ï–†–Ø–ù–û: ${loss} –†–ï–°–£–†–°–û–í`);
      }
      const heal = rnd(BALANCE.rest.healMin, BALANCE.rest.healMax);
      const before = state.hp;
      state.hp = Math.min(state.hpMax, state.hp + heal);
      state.pow = state.powMax; // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–ª—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é
      log(`–û–¢–î–´–•: +${state.hp - before} HP, –°–ò–õ–ê –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ê`);
      renderStats();
      goToRoad(false);
    }

    // === –î–ï–†–ï–í–ù–Ø ===
    function enterVillage(){
      state.scene = 'village';
      const rate = rnd(BALANCE.village.rateMin, BALANCE.village.rateMax);
      const restPrice = rnd(BALANCE.village.restPriceMin, BALANCE.village.restPriceMax);
      const forgePrice = BALANCE.village.forgeBasePrice + (state.atk - 1) * BALANCE.village.forgePriceStep;
      const tavernPrice = Math.floor(BALANCE.village.tavernBasePrice * Math.pow(BALANCE.village.tavernPriceMultiplier, state.powMax - 50));
      
      state.village = { rate, restPrice, forgePrice, tavernPrice };

      setText(`<b>–î–ï–†–ï–í–ù–Ø.</b>`+
              `<div><small class=\"muted\">–ö–£–†–°: 1 –†–ï–°–£–†–° = ${rate} –ó–û–õ–û–¢–ê</small></div>`+
              `<div><small class=\"muted\">–û–¢–î–´–•: –ü–û–õ–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ó–ê ${restPrice} –ó–û–õ–û–¢–ê</small></div>`+
              `<div><small class=\"muted\">–ö–£–ó–ù–ï–¶: +1 –ê–¢–ê–ö–ê –ó–ê ${forgePrice} –ó–û–õ–û–¢–ê</small></div>`+
              `<div><small class=\"muted\">–¢–ê–í–ï–†–ù–ê: +10 –°–ò–õ–´ –ó–ê ${tavernPrice} –ó–û–õ–û–¢–ê</small></div>`);

      setActions([
        { label: `–¢–û–†–ì–û–í–ê–¢–¨ (–í–°–Å)`, onClick: tradeAll, disabled: state.res <= 0 },
        { label: `–û–¢–î–´–• (${restPrice})`, onClick: restVillage, disabled: state.gold < restPrice },
        { label: `–ö–£–ó–ù–ï–¶ (${forgePrice})`, onClick: forge, disabled: state.gold < forgePrice },
        { label: `–¢–ê–í–ï–†–ù–ê (${tavernPrice})`, onClick: tavern, disabled: state.gold < tavernPrice },
        { label: '–î–ê–õ–¨–®–ï', className: 'accent', onClick: ()=>{ log('–í–´–•–û–î –ò–ó –î–ï–†–ï–í–ù–ò...'); goToRoad(false); } }
      ]);

      log('–í–•–û–î –í –î–ï–†–ï–í–ù–Æ');
    }

    function tradeAll(){
      const { rate } = state.village;
      const amount = state.res;
      const gain = amount * rate;
      state.res = 0;
      state.gold += gain;
      log(`–û–ë–ú–ï–ù: ${amount} –†–ï–°–£–†–°–û–í ‚Üí ${gain} –ó–û–õ–û–¢–ê (–ö–£–†–° ${rate})`);
      renderStats();
      enterVillage();
    }

    function restVillage(){
      const { restPrice } = state.village;
      if (state.gold < restPrice) return;
      state.gold -= restPrice;
      const healed = state.hpMax - state.hp;
      state.hp = state.hpMax;
      state.pow = state.powMax;
      log(`–û–¢–î–´–• –í –¢–ê–í–ï–†–ù–ï: +${healed} HP, –°–ò–õ–ê –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ê. -${restPrice} –ó–û–õ–û–¢–ê`);
      renderStats();
      enterVillage();
    }

    function forge(){
      const { forgePrice } = state.village;
      if (state.gold < forgePrice) return;
      state.gold -= forgePrice;
      state.atk += 1;
      log(`–ö–£–ó–ù–ï–¶: –ê–¢–ê–ö–ê +1. -${forgePrice} –ó–û–õ–û–¢–ê`);
      renderStats();
      enterVillage();
    }

    function tavern(){
      const { tavernPrice } = state.village;
      if (state.gold < tavernPrice) return;
      state.gold -= tavernPrice;
      state.powMax += 10;
      state.pow = state.powMax; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏–ª—É –¥–æ –Ω–æ–≤–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞
      log(`–¢–ê–í–ï–†–ù–ê: –ú–ê–ö–°. –°–ò–õ–ê +10 (–¢–ï–ü–ï–†–¨ ${state.powMax}). -${tavernPrice} –ó–û–õ–û–¢–ê`);
      renderStats();
      enterVillage();
    }

    // === –õ–ï–° ===
    function enterForest(){
      state.scene = 'forest';
      state.forestCost = rnd(BALANCE.forest.powCostMin, BALANCE.forest.powCostMax); // –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π
      setText(`<b>–õ–ï–°.</b> –û–•–û–¢–ê –ó–ê –†–ï–°–£–†–°–ê–ú–ò. <small class=\"muted\">–¢–†–ï–ë–£–ï–¢–°–Ø ${state.forestCost} –°–ò–õ–´</small>`);
      setActions([
        { label: `–û–•–û–¢–ê (-${state.forestCost})`, onClick: hunt, disabled: state.pow < state.forestCost },
        { label: '–î–ê–õ–¨–®–ï', className: 'accent', onClick: ()=>{ log('–í–´–•–û–î –ò–ó –õ–ï–°–ê...'); goToRoad(false); } }
      ]);
      log('–í–•–û–î –í –õ–ï–°');
    }

    function hunt(){
      const cost = state.forestCost ?? BALANCE.forest.powCostMin;
      if (state.pow < cost){ log('–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–ò–õ–´ –î–õ–Ø –û–•–û–¢–´'); return; }
      state.pow -= cost;
      const gain = rnd(BALANCE.forest.resMin, BALANCE.forest.resMax);
      state.res += gain;
      log(`–û–•–û–¢–ê: +${gain} –†–ï–°–£–†–°–û–í. -${cost} –°–ò–õ–´`);
      if (chance(BALANCE.forest.hurtChance)){
        const hurt = rnd(BALANCE.forest.hurtMin, BALANCE.forest.hurtMax);
        state.hp -= hurt;
        log(`–†–ê–ù–ï–ù–ò–ï: -${hurt} HP`);
        if (state.hp <= 0) return gameOver('–í–´ –ò–°–¢–ï–ö–õ–ò –ö–†–û–í–¨–Æ –í –õ–ï–°–£');
      }
      renderStats();
      enterForest();
    }

    // === –û–ó–ï–†–û ===
    function enterLake(){
      state.scene = 'lake';
      state.lakeCost = rnd(BALANCE.lake.powCostMin, BALANCE.lake.powCostMax); // –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π
      setText(`<b>–û–ó–ï–†–û.</b> –†–´–ë–ê–õ–ö–ê. <small class=\"muted\">–¢–†–ï–ë–£–ï–¢–°–Ø ${BALANCE.lake.baitCost} –†–ï–°–£–†–° –ò ${state.lakeCost} –°–ò–õ–´</small>`);
      setActions([
        { label: `–†–´–ë–ê–õ–ö–ê (-${state.lakeCost})`, onClick: fish, disabled: state.res < BALANCE.lake.baitCost || state.pow < state.lakeCost },
        { label: '–î–ê–õ–¨–®–ï', className: 'accent', onClick: ()=>{ log('–í–´–•–û–î –û–¢ –û–ó–ï–†–ê...'); goToRoad(false); } }
      ]);
      log('–ü–û–î–•–û–î –ö –û–ó–ï–†–£');
    }

    function fish(){
      const cost = state.lakeCost ?? BALANCE.lake.powCostMin;
      if (state.res < BALANCE.lake.baitCost){ log('–ù–£–ñ–ù–ê –ù–ê–ñ–ò–í–ö–ê (–†–ï–°–£–†–°–´)'); return; }
      if (state.pow < cost){ log('–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–ò–õ–´ –î–õ–Ø –†–´–ë–ê–õ–ö–ò'); return; }
      state.res -= BALANCE.lake.baitCost;
      state.pow -= cost;
      if (chance(BALANCE.lake.successChance)){
        const gain = rnd(BALANCE.lake.resGainMin, BALANCE.lake.resGainMax);
        state.res += gain;
        log(`–†–´–ë–ê–õ–ö–ê –£–°–ü–ï–®–ù–ê: +${gain} –†–ï–°–£–†–°–û–í. -${BALANCE.lake.baitCost} –†–ï–°–£–†–°, -${cost} –°–ò–õ–´`);
      } else {
        log(`–†–´–ë–ê–õ–ö–ê –ü–†–û–í–ê–õ–ï–ù–ê. -${BALANCE.lake.baitCost} –†–ï–°–£–†–°, -${cost} –°–ò–õ–´`);
      }
      renderStats();
      enterLake();
    }

    // === –ö–û–ù–ï–¶ –ò–ì–†–´ / –†–ï–°–¢–ê–†–¢ ===
    function gameOver(reason){
      state.scene = 'dead';
      setText(`<b>–í–´ –ü–û–ì–ò–ë–õ–ò.</b> ${reason}`);
      setActions([{ label: '–ù–û–í–ê–Ø –ò–ì–†–ê', className: 'accent', onClick: resetGame }]);
      log(`GAME OVER. ${reason}`);
    }

    function resetGame(){
      state.hp = 100; state.hpMax = 100;
      state.gold = 10; state.res = 0; state.atk = 1;
      state.pow = 50; state.powMax = 50;
      state.enemy = null; state.village = { rate:null, restPrice:null, forgePrice:null, tavernPrice:null };
      state.forestCost = null; state.lakeCost = null;
      document.getElementById('history').innerHTML = '';
      state.log = [];
      renderStats();
      goToRoad(true);
    }

    // === –¢–£–õ–ë–ê–† –ò –°–¢–ê–†–¢ ===
    document.getElementById('clearLog').onclick = () => { document.getElementById('history').innerHTML=''; log('–õ–û–ì –û–ß–ò–©–ï–ù'); };
    document.getElementById('restart').onclick = resetGame;

    renderStats();
    goToRoad(true);
  </script>
</body>
</html>