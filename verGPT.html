<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–¢–µ–∫—Å—Ç–æ–≤–∞—è RPG ‚Äî –î–æ—Ä–æ–≥–∞</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --text:#e5e7eb; --muted:#9ca3af;
      --accent:#16a34a; --danger:#ef4444; --btn:#1f2937; --btnHover:#374151;
      --shadow:rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .container{max-width:860px; margin:24px auto; padding:0 16px 24px}
    .stats{display:grid; grid-template-columns:repeat(5,1fr); gap:8px; position:sticky; top:0; padding-top:8px; padding-bottom:8px; background:linear-gradient(var(--bg),rgba(15,23,42,.8)); backdrop-filter:saturate(1.2) blur(2px); z-index:5}
    .stat{background:var(--panel); border:1px solid #1f2937; border-radius:14px; padding:12px; text-align:center; box-shadow:0 6px 16px var(--shadow)}
    #scene{margin-top:16px; background:var(--panel); border:1px solid #1f2937; border-radius:14px; padding:16px; box-shadow:0 6px 16px var(--shadow)}
    #text{line-height:1.5}
    #actions{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px}
    button{background:var(--btn); border:1px solid #374151; border-radius:12px; padding:10px 14px; color:var(--text); cursor:pointer; font-weight:600}
    button:hover{background:var(--btnHover)}
    button:disabled{opacity:.55; cursor:not-allowed}
    button.accent{border-color:var(--accent)}
    button.danger{border-color:var(--danger)}
    #history{margin-top:16px; background:#0b1220; border:1px solid #1f2937; border-radius:14px; padding:12px; height:260px; overflow-y:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; white-space:pre-wrap}
    small.muted{color:var(--muted)}
    .toolbar{display:flex; gap:8px; margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <div class="stats">
      <div class="stat">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: <span id="hp"></span>/<span id="hpMax"></span></div>
      <div class="stat">ü™ô –ó–æ–ª–æ—Ç–æ: <span id="gold"></span></div>
      <div class="stat">ü™µ –†–µ—Å—É—Ä—Å—ã: <span id="res"></span></div>
      <div class="stat">üí• –ê—Ç–∞–∫–∞: <span id="atk"></span></div>
      <div class="stat">‚ö° –°–∏–ª–∞: <span id="pow"></span>/<span id="powMax"></span></div>
    </div>

    <div id="scene">
      <div id="text"></div>
      <div id="actions"></div>
    </div>

    <div id="history" aria-label="–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π (–ª–æ–≥)"></div>
    <div class="toolbar">
      <button id="clearLog">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
      <button id="restart">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>
  </div>

  <script>
    // === –°–û–°–¢–û–Ø–ù–ò–ï ===
    const state = {
      hp: 100, hpMax: 100,
      gold: 10,
      res: 0,
      atk: 1, // –≤–ª–∏—è–µ—Ç –Ω–∞ —É—Ä–æ–Ω –ø–æ –≤—Ä–∞–≥—É (–∫—É–∑–Ω–µ—Ü –ø–æ–≤—ã—à–∞–µ—Ç)
      pow: 50, powMax: 50, // –Ω–æ–≤–∞—è ¬´—Å–∏–ª–∞¬ª ‚Äî —Ç—Ä–∞—Ç–∏—Ç—Å—è –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
      scene: 'road',
      enemy: null,
      village: { rate: null, restPrice: null, forgePrice: null },
      forestCost: null, // —Ç–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–∏–ª—ã –¥–ª—è –æ—Ö–æ—Ç—ã (–∑–∞ –≤—Ö–æ–¥ –≤ –ª–µ—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ)
      lakeCost: null,   // —Ç–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–∏–ª—ã –¥–ª—è —Ä—ã–±–∞–ª–∫–∏ (–∑–∞ –≤—Ö–æ–¥ –∫ –æ–∑–µ—Ä—É –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ)
      log: []
    };

    // === –ë–ê–õ–ê–ù–° ===
    const BALANCE = {
      roadWeights: { enemy: 0.4, village: 0.25, forest: 0.2, lake: 0.15 },
      fleeGoldMin: 2, fleeGoldMax: 10,
      enemy: { hpMin: 15, hpMax: 35, dmgMin: 3, dmgMax: 8, playerBaseDmgMin: 3, playerBaseDmgMax: 7, rewardResMin: 1, rewardResMax: 5 },
      rest: { healMin: 15, healMax: 30, robChance: 0.12, robMin: 1, robMax: 15 },
      village: { rateMin: 3, rateMax: 7, restPriceMin: 8, restPriceMax: 14, forgeBasePrice: 12, forgePriceStep: 6 },
      forest: { resMin: 1, resMax: 3, hurtChance: 0.35, hurtMin: 1, hurtMax: 4, powCostMin: 5, powCostMax: 15 },
      lake: { baitCost: 1, successChance: 0.65, resGainMin: 3, resGainMax: 5, powCostMin: 5, powCostMax: 15 }
    };

    const ENEMY_NAMES = ["–í–æ–ª–∫", "–†–∞–∑–±–æ–π–Ω–∏–∫", "–ü–æ–∫–æ–π–Ω–∏–∫", "–ú–µ–¥–≤–µ–¥—å", "–ì–æ–±–ª–∏–Ω", "–û—Ä–∫", "–ë–∞–Ω–¥–∏—Ç", "–í–µ–ø—Ä—å"];

    // === –£–¢–ò–õ–ò–¢–´ ===
    const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const chance = (p) => Math.random() < p;
    function log(msg){
      state.log.push(msg);
      const h = document.getElementById('history');
      const el = document.createElement('div');
      el.textContent = msg;
      h.appendChild(el);
      h.scrollTop = h.scrollHeight;
    }

    // === –†–ï–ù–î–ï–† ===
    function renderStats(){
      document.getElementById('hp').textContent = state.hp;
      document.getElementById('hpMax').textContent = state.hpMax;
      document.getElementById('gold').textContent = state.gold;
      document.getElementById('res').textContent = state.res;
      document.getElementById('atk').textContent = state.atk;
      document.getElementById('pow').textContent = state.pow;
      document.getElementById('powMax').textContent = state.powMax;
    }
    function setText(html){ document.getElementById('text').innerHTML = html; }
    function setActions(buttons){
      const c = document.getElementById('actions');
      c.innerHTML = '';
      buttons.forEach(b=>{
        const btn = document.createElement('button');
        btn.textContent = b.label;
        if(b.className) btn.className = b.className;
        btn.onclick = b.onClick;
        if (b.disabled) btn.disabled = true;
        c.appendChild(btn);
      });
    }

    // === –î–û–†–û–ì–ê ===
    function goToRoad(initial=false){
      state.scene = 'road';
      setText(initial
        ? '<b>–í—ã –Ω–∞ –¥–æ—Ä–æ–≥–µ.</b> –ù–∞–∂–º–∏—Ç–µ ¬´–ò–¥—Ç–∏¬ª, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ –ø—É—Ç—å.'
        : '<b>–í—ã —Å–Ω–æ–≤–∞ –Ω–∞ –¥–æ—Ä–æ–≥–µ.</b> –ß—Ç–æ –≤–∞—Å –∂–¥—ë—Ç –¥–∞–ª—å—à–µ?');
      setActions([{ label: '–ò–¥—Ç–∏', className: 'accent', onClick: ()=>{ log('–í—ã –∏–¥—ë—Ç–µ –ø–æ –¥–æ—Ä–æ–≥–µ...'); rollEvent(); } }]);
      if (initial) log('–í—ã –≤—ã—à–ª–∏ –Ω–∞ –¥–æ—Ä–æ–≥—É.');
    }

    function rollEvent(){
      const r = Math.random();
      const w = BALANCE.roadWeights; let acc = 0;
      if (r < (acc += w.enemy)) return enterEnemy();
      if (r < (acc += w.village)) return enterVillage();
      if (r < (acc += w.forest)) return enterForest();
      return enterLake();
    }

    // === –í–†–ê–ì ===
    function enterEnemy(){
      const eHP = rnd(BALANCE.enemy.hpMin, BALANCE.enemy.hpMax);
      const eDmg = rnd(BALANCE.enemy.dmgMin, BALANCE.enemy.dmgMax);
      const name = ENEMY_NAMES[rnd(0, ENEMY_NAMES.length-1)];
      state.enemy = { hp: eHP, dmg: eDmg, name };
      state.scene = 'enemy';
      setText(`<b>${name}!</b> –ó–¥–æ—Ä–æ–≤—å–µ –≤—Ä–∞–≥–∞: ${eHP}. –£—Ä–æ–Ω –≤—Ä–∞–≥–∞: ${eDmg}.`);
      setActions([
        { label: '–£–¥–∞—Ä–∏—Ç—å (-1 —Å–∏–ª–∞)', className: 'danger', onClick: attackEnemy, disabled: state.pow <= 0 },
        { label: '–°–±–µ–∂–∞—Ç—å', onClick: fleeEnemy }
      ]);
      log(`–ù–∞ –¥–æ—Ä–æ–≥–µ –ø–æ—è–≤–∏–ª—Å—è ${name} (HP ${eHP}, DMG ${eDmg}).`);
    }

    function attackEnemy(){
      if (state.scene !== 'enemy' || !state.enemy) return;
      if (state.pow <= 0){ log('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∏–ª—ã –¥–ª—è —É–¥–∞—Ä–∞.'); return; }
      state.pow -= 1;
      const dmg = rnd(BALANCE.enemy.playerBaseDmgMin, BALANCE.enemy.playerBaseDmgMax) + state.atk;
      state.enemy.hp -= dmg;
      log(`–í—ã —É–¥–∞—Ä–∏–ª–∏ ${state.enemy.name} –Ω–∞ ${dmg} —É—Ä–æ–Ω–∞. (HP –≤—Ä–∞–≥–∞: ${Math.max(0, state.enemy.hp)})`);

      if (state.enemy.hp <= 0){
        const gain = rnd(BALANCE.enemy.rewardResMin, BALANCE.enemy.rewardResMax);
        state.res += gain;
        log(`${state.enemy.name} –ø–æ–≤–µ—Ä–∂–µ–Ω! –í—ã –ø–æ–ª—É—á–∏–ª–∏ —Ä–µ—Å—É—Ä—Å—ã: +${gain}.`);
        state.enemy = null;
        state.scene = 'postBattle';
        setText(`<b>–ü–æ–±–µ–¥–∞!</b> –ß—Ç–æ –¥–∞–ª—å—à–µ?`);
        setActions([
          { label: '–ò–¥—Ç–∏', className: 'accent', onClick: ()=>{ log('–í—ã –¥–≤–∏–Ω—É–ª–∏—Å—å –¥–∞–ª—å—à–µ...'); goToRoad(false); } },
          { label: '–û—Ç–¥–æ—Ö–Ω—É—Ç—å', onClick: restOutside }
        ]);
        renderStats();
        return;
      }

      // –û—Ç–≤–µ—Ç–Ω—ã–π —É–¥–∞—Ä –≤—Ä–∞–≥–∞
      const eHit = rnd(state.enemy.dmg, state.enemy.dmg + 2);
      state.hp -= eHit;
      log(`${state.enemy.name} —É–¥–∞—Ä–∏–ª –≤–∞—Å –Ω–∞ ${eHit} —É—Ä–æ–Ω–∞. (–í–∞—à–µ HP: ${Math.max(0, state.hp)})`);
      if (state.hp <= 0) return gameOver(`${state.enemy.name} –æ–∫–∞–∑–∞–ª—Å—è —Å–∏–ª—å–Ω–µ–µ. –í—ã –ø–∞–ª–∏ –≤ –±–æ—é.`);

      setText(`<b>–ë–æ–π!</b> ${state.enemy.name} –µ—â—ë –¥–µ—Ä–∂–∏—Ç—Å—è.`);
      setActions([
        { label: '–£–¥–∞—Ä–∏—Ç—å (-1 —Å–∏–ª–∞)', className: 'danger', onClick: attackEnemy, disabled: state.pow <= 0 },
        { label: '–°–±–µ–∂–∞—Ç—å', onClick: fleeEnemy }
      ]);
      renderStats();
    }

    function fleeEnemy(){
      const lose = Math.min(state.gold, rnd(BALANCE.fleeGoldMin, BALANCE.fleeGoldMax));
      state.gold -= lose;
      log(`–í—ã —Å–±–µ–∂–∞–ª–∏, –ø–æ—Ç–µ—Ä—è–≤ ${lose} –∑–æ–ª–æ—Ç–∞.`);
      renderStats();
      goToRoad(false);
    }

    // === –û–¢–î–´–• –í–ù–ï –î–ï–†–ï–í–ù–ò ===
    function restOutside(){
      const robbed = chance(BALANCE.rest.robChance);
      if (robbed && state.res > 0){
        const loss = Math.min(state.res, rnd(BALANCE.rest.robMin, BALANCE.rest.robMax));
        state.res -= loss;
        log(`–ü–æ–∫–∞ –≤—ã –æ—Ç–¥—ã—Ö–∞–ª–∏, –≤–∞—Å –Ω–µ–º–Ω–æ–≥–æ –æ–≥—Ä–∞–±–∏–ª–∏. –ü–æ—Ç–µ—Ä—è–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤: ${loss}.`);
      }
      const heal = rnd(BALANCE.rest.healMin, BALANCE.rest.healMax);
      const before = state.hp;
      state.hp = Math.min(state.hpMax, state.hp + heal);
      state.pow = state.powMax; // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–ª—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é
      log(`–í—ã –æ—Ç–¥–æ—Ö–Ω—É–ª–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ ${state.hp - before} HP –∏ –≤—Å—é —Å–∏–ª—É.`);
      renderStats();
      goToRoad(false);
    }

    // === –î–ï–†–ï–í–ù–Ø ===
    function enterVillage(){
      state.scene = 'village';
      const rate = rnd(BALANCE.village.rateMin, BALANCE.village.rateMax);
      const restPrice = rnd(BALANCE.village.restPriceMin, BALANCE.village.restPriceMax);
      const forgePrice = BALANCE.village.forgeBasePrice + (state.atk - 1) * BALANCE.village.forgePriceStep;
      state.village = { rate, restPrice, forgePrice };

      setText(`<b>–î–µ—Ä–µ–≤–Ω—è.</b>`+
              `<div><small class=\"muted\">–ö—É—Ä—Å –æ–±–º–µ–Ω–∞: 1 —Ä–µ—Å—É—Ä—Å = ${rate} –∑–æ–ª–æ—Ç–∞.</small></div>`+
              `<div><small class=\"muted\">–û—Ç–¥—ã—Ö: –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞ ${restPrice} –∑–æ–ª–æ—Ç–∞.</small></div>`+
              `<div><small class=\"muted\">–ö—É–∑–Ω–µ—Ü: +1 –∞—Ç–∞–∫–∞ –∑–∞ ${forgePrice} –∑–æ–ª–æ—Ç–∞.</small></div>`);

      setActions([
        { label: `–¢–æ—Ä–≥–æ–≤–∞—Ç—å (–æ–±–º–µ–Ω—è—Ç—å –≤—Å—ë)`, onClick: tradeAll, disabled: state.res <= 0 },
        { label: `–û—Ç–¥–æ—Ö–Ω—É—Ç—å (${restPrice} –∑–æ–ª–æ—Ç–∞)`, onClick: restVillage, disabled: state.gold < restPrice },
        { label: `–ö—É–∑–Ω–µ—Ü (+1 –∞—Ç–∞–∫–∞ –∑–∞ ${forgePrice})`, onClick: forge, disabled: state.gold < forgePrice },
        { label: '–ò–¥—Ç–∏ –¥–∞–ª—å—à–µ', className: 'accent', onClick: ()=>{ log('–í—ã –ø–æ–∫–∏–Ω—É–ª–∏ –¥–µ—Ä–µ–≤–Ω—é –∏ –¥–≤–∏–Ω—É–ª–∏—Å—å –¥–∞–ª—å—à–µ...'); goToRoad(false); } }
      ]);

      log('–í—ã –≤–æ—à–ª–∏ –≤ –¥–µ—Ä–µ–≤–Ω—é.');
    }

    function tradeAll(){
      const { rate } = state.village;
      const amount = state.res;
      const gain = amount * rate;
      state.res = 0;
      state.gold += gain;
      log(`–í—ã –æ–±–º–µ–Ω—è–ª–∏ ${amount} —Ä–µ—Å—É—Ä—Å(–æ–≤) –ø–æ –∫—É—Ä—Å—É ${rate} –∏ –ø–æ–ª—É—á–∏–ª–∏ ${gain} –∑–æ–ª–æ—Ç–∞.`);
      renderStats();
      enterVillage();
    }

    function restVillage(){
      const { restPrice } = state.village;
      if (state.gold < restPrice) return;
      state.gold -= restPrice;
      const healed = state.hpMax - state.hp;
      state.hp = state.hpMax;
      state.pow = state.powMax;
      log(`–í—ã –ø–µ—Ä–µ–Ω–æ—á–µ–≤–∞–ª–∏ –≤ —Ç–∞–≤–µ—Ä–Ω–µ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ (+${healed} HP) –∏ —Å–∏–ª—É. (-${restPrice} –∑–æ–ª–æ—Ç–∞)`);
      renderStats();
      enterVillage();
    }

    function forge(){
      const { forgePrice } = state.village;
      if (state.gold < forgePrice) return;
      state.gold -= forgePrice;
      state.atk += 1;
      log(`–ö—É–∑–Ω–µ—Ü —É–∫—Ä–µ–ø–∏–ª –≤–∞—à–µ –æ—Ä—É–∂–∏–µ. –ê—Ç–∞–∫–∞ +1. (-${forgePrice} –∑–æ–ª–æ—Ç–∞)`);
      renderStats();
      enterVillage();
    }

    // === –õ–ï–° ===
    function enterForest(){
      state.scene = 'forest';
      state.forestCost = rnd(BALANCE.forest.powCostMin, BALANCE.forest.powCostMax); // –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π
      setText(`<b>–õ–µ—Å.</b> –ú–æ–∂–Ω–æ –ø–æ–æ—Ö–æ—Ç–∏—Ç—å—Å—è –∑–∞ —Ä–µ—Å—É—Ä—Å–∞–º–∏. <small class=\"muted\">–û—Ö–æ—Ç–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç ${state.forestCost} —Å–∏–ª—ã.</small>`);
      setActions([
        { label: `–û—Ö–æ—Ç–∏—Ç—å—Å—è (-${state.forestCost} —Å–∏–ª–∞)`, onClick: hunt, disabled: state.pow < state.forestCost },
        { label: '–ò–¥—Ç–∏ –¥–∞–ª—å—à–µ', className: 'accent', onClick: ()=>{ log('–í—ã –≤—ã—à–ª–∏ –∏–∑ –ª–µ—Å–∞ –∏ –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ...'); goToRoad(false); } }
      ]);
      log('–í—ã –≤–æ—à–ª–∏ –≤ –ª–µ—Å.');
    }

    function hunt(){
      const cost = state.forestCost ?? BALANCE.forest.powCostMin;
      if (state.pow < cost){ log('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∏–ª—ã –¥–ª—è –æ—Ö–æ—Ç—ã.'); return; }
      state.pow -= cost;
      const gain = rnd(BALANCE.forest.resMin, BALANCE.forest.resMax);
      state.res += gain;
      log(`–í—ã –ø–æ–æ—Ö–æ—Ç–∏–ª–∏—Å—å –∏ –ø–æ–ª—É—á–∏–ª–∏ —Ä–µ—Å—É—Ä—Å—ã: +${gain}. (-${cost} —Å–∏–ª—ã)`);
      if (chance(BALANCE.forest.hurtChance)){
        const hurt = rnd(BALANCE.forest.hurtMin, BALANCE.forest.hurtMax);
        state.hp -= hurt;
        log(`–ù–æ –≤—ã –ø–æ—Ä–∞–Ω–∏–ª–∏—Å—å –∏ –ø–æ—Ç–µ—Ä—è–ª–∏ ${hurt} HP.`);
        if (state.hp <= 0) return gameOver('–í—ã –∏—Å—Ç–µ–∫–ª–∏ –∫—Ä–æ–≤—å—é –≤ –ª–µ—Å—É.');
      }
      renderStats();
      // –ø–æ—Å–ª–µ –æ—Ö–æ—Ç—ã –æ—Å—Ç–∞—ë–º—Å—è –≤ –ª–µ—Å—É, –Ω–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å—Å—è, —á—Ç–æ–±—ã \"–∫–∞–∂–¥—ã–π —Ä–∞–∑ –±—ã–ª–∞ —Ä–∞–∑–Ω–∞—è\"
      enterForest();
    }

    // === –û–ó–ï–†–û ===
    function enterLake(){
      state.scene = 'lake';
      state.lakeCost = rnd(BALANCE.lake.powCostMin, BALANCE.lake.powCostMax); // –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π
      setText(`<b>–û–∑–µ—Ä–æ.</b> –ú–æ–∂–Ω–æ –ø–æ—Ä—ã–±–∞—á–∏—Ç—å: –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è ${BALANCE.lake.baitCost} —Ä–µ—Å—É—Ä—Å(–∞) –∫–∞–∫ –Ω–∞–∂–∏–≤–∫–∞. <small class=\"muted\">–†—ã–±–∞–ª–∫–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç ${state.lakeCost} —Å–∏–ª—ã.</small>`);
      setActions([
        { label: `–ü–æ—Ä—ã–±–∞—á–∏—Ç—å (-${state.lakeCost} —Å–∏–ª–∞)`, onClick: fish, disabled: state.res < BALANCE.lake.baitCost || state.pow < state.lakeCost },
        { label: '–ò–¥—Ç–∏ –¥–∞–ª—å—à–µ', className: 'accent', onClick: ()=>{ log('–í—ã –æ—Å—Ç–∞–≤–∏–ª–∏ –æ–∑–µ—Ä–æ –ø–æ–∑–∞–¥–∏ –∏ –¥–≤–∏–Ω—É–ª–∏—Å—å –¥–∞–ª—å—à–µ...'); goToRoad(false); } }
      ]);
      log('–í—ã –ø–æ–¥–æ—à–ª–∏ –∫ –æ–∑–µ—Ä—É.');
    }

    function fish(){
      const cost = state.lakeCost ?? BALANCE.lake.powCostMin;
      if (state.res < BALANCE.lake.baitCost){ log('–ù—É–∂–Ω–∞ –Ω–∞–∂–∏–≤–∫–∞ (—Ä–µ—Å—É—Ä—Å—ã).'); return; }
      if (state.pow < cost){ log('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∏–ª—ã –¥–ª—è —Ä—ã–±–∞–ª–∫–∏.'); return; }
      state.res -= BALANCE.lake.baitCost;
      state.pow -= cost;
      if (chance(BALANCE.lake.successChance)){
        const gain = rnd(BALANCE.lake.resGainMin, BALANCE.lake.resGainMax);
        state.res += gain;
        log(`–ö–ª—ë–≤ —É–¥–∞–ª—Å—è! –í—ã –≤—ã—Ç–∞—â–∏–ª–∏ —Ä–µ—Å—É—Ä—Å–æ–≤: +${gain}. (-${BALANCE.lake.baitCost} —Ä–µ—Å—É—Ä—Å, -${cost} —Å–∏–ª—ã)`);
      } else {
        log(`–°–µ–≥–æ–¥–Ω—è –Ω–µ –∫–ª—é—ë—Ç... –ù–∞–∂–∏–≤–∫–∞ –ø—Ä–æ–ø–∞–ª–∞ –≤–ø—É—Å—Ç—É—é. (-${BALANCE.lake.baitCost} —Ä–µ—Å—É—Ä—Å, -${cost} —Å–∏–ª—ã)`);
      }
      renderStats();
      // –æ—Å—Ç–∞—ë–º—Å—è —É –æ–∑–µ—Ä–∞, –Ω–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞—Ö–æ–¥–µ
      enterLake();
    }

    // === –ö–û–ù–ï–¶ –ò–ì–†–´ / –†–ï–°–¢–ê–†–¢ ===
    function gameOver(reason){
      state.scene = 'dead';
      setText(`<b>–í—ã –ø–æ–≥–∏–±–ª–∏.</b> ${reason}`);
      setActions([{ label: '–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ', className: 'accent', onClick: resetGame }]);
      log(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. ${reason}`);
    }

    function resetGame(){
      state.hp = 100; state.hpMax = 100;
      state.gold = 10; state.res = 0; state.atk = 1;
      state.pow = 50; state.powMax = 50;
      state.enemy = null; state.village = { rate:null, restPrice:null, forgePrice:null };
      state.forestCost = null; state.lakeCost = null;
      document.getElementById('history').innerHTML = '';
      state.log = [];
      renderStats();
      goToRoad(true);
    }

    // === –¢–£–õ–ë–ê–† –ò –°–¢–ê–†–¢ ===
    document.getElementById('clearLog').onclick = () => { document.getElementById('history').innerHTML=''; log('‚Äî –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞ ‚Äî'); };
    document.getElementById('restart').onclick = resetGame;

    renderStats();
    goToRoad(true);
  </script>
</body>
</html>
